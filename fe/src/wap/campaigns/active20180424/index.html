<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="format-detection" content="telphone=no, email=no"/>
    <title>520主会场</title>
    <link rel="stylesheet" href="../../common/css/wenjfbase.css">
    <link rel="stylesheet" href="css/gifts-list.css">
    <link rel="stylesheet" href="css/index.min.css?v=1.3">
    <script src="../../libs/lib.flexible3.js"></script>
    <script src="../../libs/vue.min.js"></script>
    <script src="../../libs/jquery-1.11.1.min.js"></script>
    <script src="../../libs/iscroll.js"></script>
    <script src="../../libs/handlebars-v4.0.10.js"></script>
    <script src="../../libs/fastclick.js"></script>
    <script src="js/gifts-list.js"></script>
    <script src="js/phaser.min.js"></script>
</head>
<body>
<div class="flex-content" id="active">
    <div class="banner">
        <img @click.prevent src="images/banner.png" alt="">
    </div>
    <div class="packet-rain">
        <div @click="closeRegular" class="regular">活动规则</div>
        <div class="gift-list">奖品列表</div>
        <img @click.prevent src="images/packet-rain.png" alt="">
        <div class="content">
            <p>天降红包雨</p>
            <p>每日10:00/16:00准时开启，每轮 红包数量有限，领完为止！</p>
            <p class="animated pulse" @click="packetRain" :class="{gray:isStartPacketRain}">本轮红包雨已结束</p>
        </div>
    </div>
    <div class="points">
        <div class="inner">
            <p class="title">520当天，全场5倍积分！</p>
            <table>
                <tr>
                    <td><span>年化投资(元)</span></td>
                    <td><span>原积分</span></td>
                    <td>现得积分</td>
                </tr>
                <tr>
                    <td>50000</td>
                    <td>300</td>
                    <td>1500</td>
                </tr>
                <tr>
                    <td>20000</td>
                    <td>1200</td>
                    <td>6000</td>
                </tr>
                <tr>
                    <td>50000</td>
                    <td>3000</td>
                    <td>15000</td>
                </tr>
                <tr>
                    <td>100000</td>
                    <td>6000</td>
                    <td>30000</td>
                </tr>
            </table>
            <div v-cloak class="invest" :class="{activeStatus:!activeStatus}">
                <a href="#">5月20日开启</a>
            </div>
        </div>
    </div>
    <div class="charity points">
        <div class="inner">
            <img @click.prevent src="images/charity.png" alt="">
            <p class="des">我有3枚慈善勋章</p>
            <div v-cloak @click="openPacket" class="btn" :class="{openPacketStatus:openPacketStatus}">5月20日开启</div>
        </div>
    </div>
    <div v-show="isShowPop" v-cloak class="mask">
        <div class="pop">
            <img @click.prevent src="images/open-packet.png" alt="">
            <p class="content">{{medal.award}}</p>
            <div @click="closePop" class="confirm">收下奖品</div>
        </div>
    </div>
    <div v-show="isShowRegular" v-cloak class="regular-pop">
        <div class="part-top">
            <img @click="closeRegular" src="images/close.png" alt="">
            <div class="regular-one">
                <div class="title">天降红包雨</div>
                <div class="des">
                    <p>活动时间：2018.5.16-5.20；</p>
                    <p>红包雨每日两场，分别在10点、16点开启，每轮红包限量，全部发放后本场次关闭；</p>
                    <p>每人每轮最多可参与1次，每日最多可参与2轮；</p>
                    <p>本游戏所得红包将立即到账，仅限周年庆期间使用，过期不补。</p>
                </div>
            </div>
            <div class="regular-two mgt55">
                <div class="title">全场5倍积分</div>
                <div class="des">
                    <p>活动时间：2018.5.20；</p>
                    <p>活动期间全场理财5倍积分！</p>
                </div>
            </div>
            <div class="regular-three mgt55">
                <div class="title">慈善勋章抽奖</div>
                <div class="des">
                    <p>活动时间：2018.5.20；</p>
                    <p>通过慈善任务获得的勋章，可以在活动当天进行抽奖，1枚勋章=1次抽奖机会，可获得随机现金红包或积分奖励；</p>
                    <p>抽奖所得奖励将立即到账。</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="gameStage" @click.prevent></div>
<script>
    var vm;
    $(function () {
        FastClick.attach(document.body);
        vm = new Vue({
            el: "#active",
            data: {
                promoStatus: 0,
                isStartPacketRain:'',
                isLogin: true,
                isShowPop:false,
                isShowRegular:false,
                medal:{
                    award:"<span>0.8</span>元现金红包",
                    medalCount:0
                },
            },
            created: function () {

            },
            computed:{
                activeStatus:function () {
                    return false;
                },
                openPacketStatus:function(){
                    return false;
                }
            },
            methods: {
                packetRain:function(){
                    var status = this.baseVerify();
                    if(status){
                        startRainRedPacket();
                    }
                },
                getCoupon:function(){
                    var vm = this;
                    try{
                        return $.ajax({
                            type:"GET",
                            url:"/promotion/p180520/get-packet-draw",
                            data:"",
                            success:function(data){
                                if(data.code ===0 ){
                                    switch(data.sn){
                                    }
                                } else {
                                    vm.toastCenter(data.message);
                                }
                            },
                            error:function(error){vm.toastCenter(error.responseJSON.message);},
                        });
                    } catch(err) {
                        vm.toastCenter(err);
                    }
                },
                openPacket:function(){
                    var vm =this;
                    $.ajax({
                        type:"GET",
                        url:"/promotion/p180520/get-charity-draw",
                        data:"",
                        success:function(data){
                            if(data.code ===0 ){
                                this.isShowPop = !this.isShowPop;
                                vm.medal.award = data.sn;
                                vm.medal.medalCount = data.medalCount;
                            } else {
                                vm.toastCenter(data.message);
                            }
                        },
                        error:function(error){vm.toastCenter(error.responseJSON.message);},
                    });

                },
                closePop:function () {
                    this.isShowPop = !this.isShowPop;
                },
                closeRegular:function () {
                    this.isShowRegular = !this.isShowRegular;
                },
                giftList: function () {
                    var _this = this;
                    var status;
                    switch (_this.promoStatus) {
                        case 0:
                            if (_this.isLogin) {
                                status = true;
                            } else {
                                window.location.href = "/site/login";
                            }
                            break;
                        case 1:
                            _this.toastCenter('活动未开始');
                            break;
                        case 2:
                            status = true;
                            break;
                        default:
                            break;
                    }
                    if(status){
                        $.ajax({
                            type: "GET",
                            url: "/promotion/p180423/award-list",
                            data: "{key:promo_180423}",
                            success: function (data) {
                                if (data.code === 0 && data.result.length != 0) {
                                    giftsList({
                                        isGifts: true,//有奖品，无奖品为false
                                        closeImg: 'images/close.png',
                                        list: data.result
                                    });
                                } else if (data.code === 0 && data.result.length === 0) {
                                    giftsList({
                                        isGifts: false,//无奖品为false
                                        closeImg: 'images/close.png',
                                        list: []
                                    });
                                } else {
                                    _this.toastCenter(data.message);
                                }
                            },
                            error: function (error) {
                                _this.toastCenter(error)
                            }
                        })
                    }
                },
                baseVerify: function () {
                    var _this = this;
                    switch (_this.promoStatus) {
                        case 0:
                            if (_this.isLogin) {
                                return true;
                            } else {
                                window.location.href = "/site/login";
                                return false;
                            }
                            break;
                        case 1:
                            _this.toastCenter('活动未开始');
                            return false;
                            break;
                        case 2:
                            _this.toastCenter('活动已结束');
                            return false;
                            break;
                        default:
                            break;
                    }
                },
                toastCenter: function (val, active) {
                    var $alert = $('<div class="error-info" style="display: block; position: fixed;font-size: .4rem;"><div>' + val + '</div></div>');
                    $('body').append($alert);
                    $alert.find('div').width($alert.width());
                    setTimeout(function () {
                        $alert.fadeOut();
                        setTimeout(function () {
                            $alert.remove();
                        }, 200);
                        if (active) {
                            active();
                        }
                    }, 2000);
                },
            }
        });
    });
</script>
<script src="js/index.js"></script>
</body>
</html>